#!/bin/bash

set -eu

where="$1"

CONFIGDIR=/etc/ssh

# network_"$where"=1 make

whereq=`printf '%q' "$where"`

FILTER_FILE=`readlink -f filter_file`
ME=`readlink -f "$0"`

cd "$CONFIGDIR"

SOURCE=ssh_config-in

"$FILTER_FILE" "$SOURCE" > .ssh_config.pre

{
echo "# *** generated from '$SOURCE' ***"
echo "# *** by '$ME' with argument '$where' ***"
echo 
cpp -D"network_$where=1" < .ssh_config.pre
} > .ssh_config.tmp

mv .ssh_config.tmp ssh_config
